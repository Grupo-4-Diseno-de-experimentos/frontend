<div class="max-w-5xl mx-auto p-8">
  <mat-card class="shadow-2xl rounded-2xl bg-white">
    <mat-card-header class="pb-0">
      <mat-card-title class="text-3xl font-bold text-gray-800">
        Crear Nueva Receta
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="p-6 space-y-10">
      <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()" class="space-y-10">

        <section>
          <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Información Básica</h3>

          <div class="space-y-6">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Título*</mat-label>
              <input matInput formControlName="title" placeholder="Ej: Ensalada César" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Descripción</mat-label>
              <textarea matInput formControlName="description" rows="2" placeholder="Breve descripción de la receta"></textarea>
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Instrucciones*</mat-label>
              <textarea matInput formControlName="instructions" rows="6" placeholder="Describe paso a paso cómo preparar la receta..."></textarea>
            </mat-form-field>
          </div>
        </section>

        <section>
          <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Información Nutricional</h3>

          <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Calorías (kcal)*</mat-label>
              <input matInput type="number" formControlName="calories" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Carbohidratos (g)*</mat-label>
              <input matInput type="number" formControlName="carbs" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Proteínas (g)*</mat-label>
              <input matInput type="number" formControlName="proteins" />
            </mat-form-field>

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Grasas (g)*</mat-label>
              <input matInput type="number" formControlName="fats" />
            </mat-form-field>
          </div>
        </section>

        <section>
          <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Ingredientes</h3>

          <div class="space-y-4">

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Buscar y agregar ingredientes</mat-label>
              <input
                type="text"
                matInput
                [matAutocomplete]="auto"
                [(ngModel)]="ingredientSearch"
                [ngModelOptions]="{standalone: true}"
                (input)="searchIngredients()"
              />
            </mat-form-field>

            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="addIngredient($event.option.value)">
              <mat-option *ngFor="let ingredient of filteredIngredients" [value]="ingredient">
                {{ ingredient.name }} – {{ ingredient.calories }} kcal
              </mat-option>
            </mat-autocomplete>

            <mat-card *ngIf="selectedIngredients.length" class="bg-gray-50 border rounded-md">
              <mat-card-content>
                <div class="space-y-4">
                  <div *ngFor="let ingredient of selectedIngredients; let i = index" class="flex justify-between items-center">
                    <div>
                      <span class="font-medium">{{ ingredient.name }}</span>
                      <span class="ml-2 text-gray-500 text-sm">{{ ingredient.calories }} kcal</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <input
                        type="number"
                        [(ngModel)]="ingredient.quantity"
                        [ngModelOptions]="{standalone: true}"
                        class="w-20 px-2 py-1 border rounded text-sm"
                      />
                      <span class="text-sm">g</span>
                      <button mat-icon-button color="warn" (click)="removeIngredient(i)">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </section>

        <div class="flex justify-end gap-4">
          <button mat-stroked-button color="warn" type="button" (click)="cancel()">Cancelar</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!recipeForm.valid">
            Guardar Receta
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
