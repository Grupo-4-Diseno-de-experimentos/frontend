<div class="max-w-5xl mx-auto p-6 text-gray-800">
  <mat-card class="shadow-2xl rounded-2xl overflow-hidden bg-gradient-to-br from-green-50 to-green-100 border border-green-200">
    <mat-card-header class="p-6 pb-0">
      <mat-card-title class="text-3xl font-extrabold text-green-800">
        Crear nuevo plan de comida
      </mat-card-title>
      <mat-card-subtitle class="text-green-600">Complete los detalles para crear un plan nutricional personalizado</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="card-content p-6 space-y-6">
      <form [formGroup]="mealPlanForm" (ngSubmit)="onSubmit()" class="space-y-8">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div class="space-y-6">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre del Plan</mat-label>
              <input matInput formControlName="name" class="bg-green-50 rounded-lg">
              <mat-icon matSuffix class="text-green-500">restaurant_menu</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Categoría</mat-label>
              <input matInput formControlName="category" class="bg-green-50 rounded-lg">
              <mat-icon matSuffix class="text-green-500">category</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Meta del Plan</mat-label>
              <mat-select formControlName="goal" class="bg-green-50 rounded-lg">
                <mat-option value="weight_loss" class="text-green-800">Pérdida de peso</mat-option>
                <mat-option value="muscle_gain" class="text-green-800">Ganar masa muscular</mat-option>
                <mat-option value="maintenance" class="text-green-800">Mantenimiento</mat-option>
              </mat-select>
              <mat-icon matSuffix class="text-green-500">fitness_center</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Descripción</mat-label>
              <textarea matInput formControlName="description" class="bg-green-50 rounded-lg" rows="3"></textarea>
            </mat-form-field>
          </div>


          <div class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
              <mat-form-field appearance="outline">
                <mat-label>IMC Mínimo</mat-label>
                <input matInput type="number" formControlName="min_bmi" class="bg-green-50 rounded-lg">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>IMC Máximo</mat-label>
                <input matInput type="number" formControlName="max_bmi" class="bg-green-50 rounded-lg">
              </mat-form-field>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <mat-form-field appearance="outline">
                <mat-label>Edad Mínima</mat-label>
                <input matInput type="number" formControlName="min_age" class="bg-green-50 rounded-lg">
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Edad Máxima</mat-label>
                <input matInput type="number" formControlName="max_age" class="bg-green-50 rounded-lg">
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Calorías por día</mat-label>
              <input matInput type="number" formControlName="calories_per_day" class="bg-green-50 rounded-lg">
              <mat-icon matSuffix class="text-green-500">local_fire_department</mat-icon>
            </mat-form-field>
          </div>
        </div>


        <div class="pt-6 border-t border-green-200">
          <h2 class="text-xl font-semibold text-green-700 mb-4 flex items-center">
            <mat-icon class="mr-2 text-green-600">restaurant</mat-icon>
            Agregar comidas al plan
          </h2>

          <div formArrayName="recipesByDay" class="space-y-4">
            <mat-accordion multi>
              <mat-expansion-panel *ngFor="let dayGroup of recipesByDay.controls; let i = index"
                                   [formGroupName]="i"
                                   class="border border-green-200 shadow-sm mb-2">
                <mat-expansion-panel-header class="hover:bg-green-50">
                  <mat-panel-title class="text-green-700 font-medium">
                    <mat-icon class="mr-2 text-green-500">event</mat-icon>
                    {{ daysOfWeek[i] }}
                  </mat-panel-title>
                  <mat-panel-description class="text-green-600">
                    {{ getMealsControls(i).controls.length }} comidas agregadas
                  </mat-panel-description>
                </mat-expansion-panel-header>

                <div formArrayName="meals" class="space-y-4 p-2">
                  <div *ngFor="let meal of getMealsControls(i).controls; let j = index"
                       [formGroupName]="j"
                       class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-white rounded-lg shadow-xs border border-green-100">

                    <mat-form-field appearance="outline">
                      <mat-label>Tipo de comida</mat-label>
                      <mat-select formControlName="meal_time" class="bg-green-50 rounded-lg">
                        <mat-option value="breakfast">Desayuno</mat-option>
                        <mat-option value="lunch">Almuerzo</mat-option>
                        <mat-option value="dinner">Cena</mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                      <mat-label>Receta</mat-label>
                      <mat-select formControlName="recipe_id" class="bg-green-50 rounded-lg">
                        <mat-option *ngFor="let recipe of allRecipes" [value]="recipe.id">
                          {{ recipe.title }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>

                    <div class="col-span-2 flex justify-end">
                      <button mat-icon-button color="warn" type="button" (click)="removeMeal(i, j)"
                              class="hover:bg-red-50">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>

                  <div class="flex justify-end pt-2">
                    <button mat-stroked-button type="button" (click)="addMeal(i)"
                            class="text-green-700 border-green-400 hover:bg-green-50">
                      <mat-icon class="mr-1">add</mat-icon>
                      Agregar comida
                    </button>
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>

        <div class="pt-6 flex justify-end space-x-4 border-t border-green-200">
          <button mat-stroked-button type="button" (click)="cancel()"
                  class="text-green-700 border-green-500 hover:bg-green-50">
            Cancelar
          </button>
          <button mat-raised-button color="primary" type="submit"
                  class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white shadow-lg">
            <mat-icon class="mr-2">save</mat-icon>
            Guardar Plan
          </button>
        </div>

      </form>
    </mat-card-content>
  </mat-card>
</div>
