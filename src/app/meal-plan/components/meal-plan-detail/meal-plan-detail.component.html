<div class="p-6 bg-green-50 min-h-screen">
  <mat-card class="bg-white rounded-2xl shadow-xl overflow-hidden border border-green-100">


    <div class="bg-gradient-to-r from-green-600 to-green-500 p-6 text-white">
      <mat-card-title class="text-3xl font-bold mb-2 flex items-center">
        <mat-icon class="mr-2">restaurant_menu</mat-icon>
        Detalles del Plan de Comidas
      </mat-card-title>
      <mat-card-subtitle class="text-green-100 opacity-90">
        Visualiza o edita la información del plan nutricional
      </mat-card-subtitle>
    </div>

    <mat-card-content class="p-6 space-y-8">


      <section class="bg-green-50 rounded-xl p-6 border-l-4 border-green-500 shadow-sm">
        <div class="flex items-center mb-4">
          <mat-icon class="text-green-600 mr-2">info</mat-icon>
          <h2 class="text-xl font-semibold text-green-800">Información del Plan</h2>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Título del Plan</mat-label>
            <input matInput [(ngModel)]="mealPlan.name" [readonly]="!isEditing"
                   class="bg-white text-green-900" />
            <mat-icon matSuffix class="text-green-500">title</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Descripción</mat-label>
            <textarea matInput rows="3" [(ngModel)]="mealPlan.description" [readonly]="!isEditing"
                      class="bg-white text-green-800"></textarea>
            <mat-icon matSuffix class="text-green-500">description</mat-icon>
            <mat-hint *ngIf="isEditing" class="text-green-600">Introduce una breve descripción del plan</mat-hint>
          </mat-form-field>
        </div>
      </section>


      <section *ngIf="mealPlanRecipes.length > 0" class="bg-teal-50 rounded-xl p-6 border-l-4 border-teal-500 shadow-sm">
        <div class="flex items-center mb-4">
          <mat-icon class="text-teal-600 mr-2">schedule</mat-icon>
          <h2 class="text-xl font-semibold text-teal-800">Recetas Programadas</h2>
        </div>

        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          <mat-card *ngFor="let recipe of mealPlanRecipes; let i = index"
                    class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 border border-green-100">
            <mat-card-header class="flex items-start">
              <div class="bg-teal-100 p-2 rounded-full mr-3">
                <mat-icon class="text-teal-600">event</mat-icon>
              </div>
              <div class="flex flex-col justify-center flex-grow">
                <mat-card-title class="text-lg font-medium text-green-800">
                  <input matInput [(ngModel)]="recipe.day" [readonly]="!isEditing"
                         class="w-full bg-transparent focus:bg-green-50 px-2 py-1 rounded"
                         placeholder="Día (ej: Lunes)" />
                </mat-card-title>
                <div class="text-green-700">
                  <input [(ngModel)]="mealPlanRecipes[i].meal_time" [readonly]="!isEditing"
                         class="w-full bg-transparent focus:bg-green-50 px-2 py-1 rounded text-sm"
                         placeholder="Hora de comida (ej: Almuerzo)" />
                </div>

                <mat-form-field *ngIf="isEditing" appearance="outline" class="w-full mt-2">
                  <mat-label>Seleccionar Receta</mat-label>
                  <mat-select [(ngModel)]="mealPlanRecipes[i].recipe_id" class="text-green-800">
                    <mat-option *ngFor="let recipe of AllRecipes" [value]="recipe.id">
                      {{ recipe.title }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <h2 *ngIf="!isEditing" class="text-teal-700 font-medium mt-1">
                  {{ recipesbyPlanId[i]?.title }}
                </h2>
              </div>
            </mat-card-header>
            <mat-card-actions align="end" class="p-2">
              <button mat-icon-button color="primary" (click)="enableEdit()" *ngIf="isNutricionist && !isEditing"
                      class="hover:bg-green-100">
                <mat-icon class="text-green-600">edit</mat-icon>
              </button>
              <button (click)="deleteMealPlanRecipe(recipe)" mat-icon-button color="warn" *ngIf="isNutricionist && isEditing"
                      class="hover:bg-red-100">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <div *ngIf="isNutricionist && !isEditing" class="mt-6 flex justify-center">
          <button mat-fab color="primary" aria-label="Añadir receta" (click)="goToCreateRecipe()"
                  class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700">
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </section>


      <section *ngIf="AllRecipes.length > 0" class="bg-white rounded-xl p-6 border-l-4 border-amber-500 shadow-sm">
        <div class="flex items-center mb-4">
          <mat-icon class="text-amber-600 mr-2">menu_book</mat-icon>
          <h2 class="text-xl font-semibold text-amber-800">Recetas Disponibles</h2>
        </div>

        <mat-accordion class="w-full">
          <mat-expansion-panel *ngFor="let recipe of recipesbyPlanId" class="mb-3 shadow-sm border border-gray-100">
            <mat-expansion-panel-header class="hover:bg-amber-50">
              <mat-panel-title class="text-green-800 font-medium">
                {{ recipe.title }}
              </mat-panel-title>
              <mat-panel-description class="text-green-600">
                <mat-icon class="mr-1">restaurant</mat-icon> Ver detalles
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="py-3 px-1 bg-amber-50">
              <p class="text-green-700 mb-3">{{ recipe.description }}</p>

              <div class="flex flex-wrap gap-2 mb-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <mat-icon class="text-xs mr-1">local_fire_department</mat-icon>
                  {{ recipe.calories }} kcal
                </span>
              </div>

              <div class="mt-4 flex justify-end">
                <button mat-stroked-button (click)="goToRecipeDetail(recipe.id)"
                        class="border-green-300 text-green-700 hover:bg-green-50">
                  <mat-icon class="mr-1">visibility</mat-icon> Ver Detalles
                </button>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </section>
    </mat-card-content>


    <mat-card-actions class="p-6 bg-green-50 flex flex-wrap justify-end gap-4 border-t border-green-100">
      <button mat-raised-button *ngIf="isNutricionist && !isEditing" (click)="enableEdit()"
              class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white">
        <mat-icon class="mr-1">edit</mat-icon> Editar Plan
      </button>

      <button mat-raised-button *ngIf="isNutricionist && isEditing" (click)="saveChanges()"
              class="bg-gradient-to-r from-teal-600 to-teal-500 hover:from-teal-700 hover:to-teal-600 text-white">
        <mat-icon class="mr-1">save</mat-icon> Guardar Cambios
      </button>

      <button mat-raised-button *ngIf="isNutricionist && isEditing" (click)="cancelEdit()"
              class="bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white">
        <mat-icon class="mr-1">close</mat-icon> Cancelar
      </button>
    </mat-card-actions>
  </mat-card>
</div>
